<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Portal do Aluno ‚Ä¢ Respect Style (Atualizado)</title>
<meta name="description" content="√Årea do aluno Respect Style ‚Äî dashboards, hor√°rios, avisos, competi√ß√µes, graduados e aniversariantes." />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<!-- Swiper (carrossel de competi√ß√µes) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
<style>
  :root{
    --bg:#0e0e10;--card:#151517;--ring:#2a2a2e;--accent:#0aa30a;--red:#e50914;
    --white:#fff;--muted:#cfd0d7;--glass: rgba(255,255,255,0.03);
    --gradient: linear-gradient(180deg,#151517,#0f0f11);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:'Inter',system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--white)}
  a{text-decoration:none;color:inherit}
  img{max-width:100%;display:block}

  /* Topbar */
  .topbar{position:sticky;top:0;z-index:60;display:flex;justify-content:space-between;align-items:center;padding:12px 18px;border-bottom:1px solid var(--ring);background:rgba(10,10,10,0.6);backdrop-filter:blur(6px)}
  .brand{display:flex;gap:12px;align-items:center}
  .brand img{width:44px;height:44px;border-radius:10px;border:2px solid var(--red);object-fit:cover}
  .title{font-weight:700}
  .top-actions{display:flex;gap:8px;align-items:center}
  .btn{padding:8px 12px;border-radius:10px;border:1px solid var(--ring);background:transparent;color:var(--white);font-weight:700;cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#00c44a);border:none}
  .btn.warn{background:linear-gradient(90deg,#ff6b6b,#ff4c4c);border:none}
  .user-pill{display:flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:var(--glass)}

  /* Layout */
  .layout{display:flex;min-height:calc(100vh - 64px)}
  .sidebar{width:260px;background:var(--gradient);border-right:1px solid var(--ring);padding:18px;display:flex;flex-direction:column;gap:12px}
  .nav-item{padding:12px;border-radius:10px;cursor:pointer}
  .nav-item:hover{background:rgba(255,255,255,0.02)}
  .nav-item.active{background:rgba(10,163,10,0.08);border:1px solid rgba(10,163,10,0.06)}
  .profile{margin-top:auto;padding-top:8px;border-top:1px solid var(--ring);display:flex;gap:12px;align-items:center}

  .main{flex:1;padding:22px;display:flex;flex-direction:column;gap:18px}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
  .card{background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--ring)}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px;color:var(--muted)}

  /* competitions swiper */
  .comp-section{margin-top:6px}
  .swiper{padding:8px 6px}
  .swiper-slide{background:var(--card);border-radius:10px;padding:12px;border:1px solid var(--ring);display:flex;flex-direction:column;gap:8px}
  .comp-date{font-size:13px;color:var(--muted)}
  .comp-title{font-weight:800}

  /* graduados */
  .graduates-list{display:flex;flex-direction:column;gap:8px;max-height:260px;overflow:auto;padding-right:6px}
  .grad-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02)}

  /* birthdays */
  .birth-list{display:flex;flex-direction:column;gap:8px}

  /* links */
  .links-list{display:flex;flex-direction:column;gap:8px}

  /* responsive */
  @media(max-width:980px){ .grid{grid-template-columns:repeat(2,1fr)} .sidebar{width:220px} }
  @media(max-width:760px){ .layout{flex-direction:column} .sidebar{order:2;width:100%;display:flex;flex-direction:row;overflow:auto;padding:10px} .sidebar .nav-item{flex:0 0 auto} .main{order:1;padding:14px} .grid{grid-template-columns:1fr} }

  .hidden{display:none}
  input.input{width:100%;padding:10px;border-radius:8px;border:1px solid var(--ring);background:#0b0b0b;color:var(--white)}

  /* Modal Loja (iframe) */
  #modalShop{
    display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:200;padding:18px;align-items:center;justify-content:center;
  }
  #modalShop .inner{
    width:min(1100px,98%);height:min(820px,96%);background:var(--card);border-radius:10px;overflow:hidden;border:1px solid var(--ring);display:flex;flex-direction:column;
  }
  #modalShop .toolbar{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid var(--ring);gap:8px}
  #modalShop .toolbar .left{display:flex;gap:8px;align-items:center}
  #modalShop iframe{border:0;width:100%;flex:1;background:#fff}
  #modalShop .note{font-size:13px;color:var(--muted)}

  /* small helpers */
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>

  <div class="topbar" role="banner">
    <div class="brand">
      <img src="../imagens/logo-respect.png" alt="Respect Style" onerror="this.src='https://via.placeholder.com/80x80?text=Logo'">
      <div>
        <div class="title">Respect Style</div>
        <div class="muted">Portal do Aluno</div>
      </div>
    </div>

    <div class="top-actions" role="navigation">
      <button class="btn" id="openShopBtn" aria-haspopup="dialog" aria-controls="modalShop">Loja</button>
      <button class="btn" id="openSupport">Suporte</button>
      <div id="authArea"></div>
      <button class="btn warn" id="adminBlockBtn" title="Bloquear usu√°rio">Bloquear Usu√°rio</button>
    </div>
  </div>

  <div class="layout" role="main">
    <aside class="sidebar" aria-label="menu lateral">
      <div>
        <div class="nav-item active" data-view="dashboard">üè† Dashboard</div>
        <div class="nav-item" data-view="schedule">üìÖ Hor√°rios</div>
        <div class="nav-item" data-view="notices">üì¢ Avisos</div>
        <div class="nav-item" data-view="events">üéüÔ∏è Eventos</div>
        <div class="nav-item" data-view="graduates">üéì Graduados</div>
        <div class="nav-item" data-view="birthdays">üéÇ Aniversariantes</div>
        <div class="nav-item" data-view="links">üîó Federa√ß√µes</div>
      </div>

      <div class="profile">
        <img id="sidebarAvatar" src="https://via.placeholder.com/64x64?text=?" alt="avatar" style="width:56px;height:56px;border-radius:8px;border:1px solid var(--ring);object-fit:cover">
        <div>
          <div id="sidebarName" style="font-weight:700">Convidado</div>
          <div id="sidebarEmail" class="small">N√£o autenticado</div>
        </div>
      </div>
    </aside>

    <section class="main">
      <!-- Dashboard -->
      <div id="view-dashboard">
        <div class="grid">
          <div class="card">
            <h3>Competi√ß√µes Pr√≥ximas</h3>
            <div class="muted">Participe e confira as datas</div>

            <!-- Swiper carousel -->
            <div class="comp-section">
              <div class="swiper mySwiper">
                <div class="swiper-wrapper" id="competitionsWrapper">
                  <!-- slides injetados via JS -->
                </div>
                <div class="swiper-button-next" aria-label="Pr√≥ximo"></div>
                <div class="swiper-button-prev" aria-label="Anterior"></div>
                <div class="swiper-pagination" aria-hidden="false"></div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>Alunos Graduados</h3>
            <div class="muted">√öltimas gradua√ß√µes</div>
            <div style="margin-top:10px">
              <input id="searchGraduate" class="input" placeholder="Buscar por nome ou faixa" />
              <div class="graduates-list" id="graduatesList" style="margin-top:10px"></div>
            </div>
          </div>

          <div class="card">
            <h3>Aniversariantes do M√™s</h3>
            <div class="muted">Celebre com a galera</div>
            <div class="birth-list" id="birthdaysList" style="margin-top:12px"></div>
          </div>
        </div>

        <div style="display:flex;gap:16px;flex-wrap:wrap;margin-top:16px">
          <div class="card" style="flex:1;min-width:320px">
            <h3>Hor√°rios R√°pidos</h3>
            <div class="muted">Confirme presen√ßa rapidamente</div>
            <div id="quickSchedule" style="margin-top:10px"></div>
          </div>

          <div class="card" style="width:380px;min-width:260px">
            <h3>Links √öteis ‚Äî Federa√ß√µes</h3>
            <div class="muted">Acesso direto</div>
            <div class="links-list" id="federationsList" style="margin-top:10px"></div>
          </div>
        </div>
      </div>

      <!-- Schedule view -->
      <div id="view-schedule" class="hidden">
        <div class="card"><h3>Hor√°rios da Semana</h3><div class="muted">Marque presen√ßa nas aulas</div><div id="fullSchedule" style="margin-top:12px"></div></div>
      </div>

      <!-- Notices view -->
      <div id="view-notices" class="hidden">
        <div class="card"><h3>Avisos</h3><div id="allNotices" style="margin-top:12px"></div></div>
      </div>

      <!-- Events (detalhe) -->
      <div id="view-events" class="hidden">
        <div class="card"><h3>Eventos</h3><div id="eventsList" style="margin-top:12px"></div></div>
      </div>

      <!-- Graduates view -->
      <div id="view-graduates" class="hidden">
        <div class="card"><h3>Todos os Graduados</h3><div id="graduatesFull" style="margin-top:12px"></div></div>
      </div>

      <!-- Birthdays view -->
      <div id="view-birthdays" class="hidden">
        <div class="card"><h3>Aniversariantes</h3><div id="birthdaysFull" style="margin-top:12px"></div></div>
      </div>

      <!-- Links view -->
      <div id="view-links" class="hidden">
        <div class="card"><h3>Federa√ß√µes e Confedera√ß√µes</h3><div id="linksFull" style="margin-top:12px"></div></div>
      </div>
    </section>
  </div>

  <!-- Login modal (demo) -->
  <div id="modalBg" class="hidden" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:80">
    <div style="width:min(480px,96%);background:var(--card);padding:18px;border-radius:12px;border:1px solid var(--ring)">
      <h3 id="modalTitle">Login</h3>
      <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
        <input id="authEmail" class="input" type="email" placeholder="E-mail (ex: aluno@ex.com)" />
        <input id="authPass" class="input" type="password" placeholder="Senha" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn primary" id="submitAuth">Entrar</button>
          <button class="btn" id="closeModal">Fechar</button>
        </div>
        <div class="muted" style="margin-top:8px">Demo: logins s√£o locais. Para desativar acesso permanente, fa√ßa bloqueio no backend (posso gerar instru√ß√£o).</div>
      </div>
    </div>
  </div>

  <!-- admin block dialog -->
  <div id="blockDialog" class="hidden" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:90">
    <div style="width:min(420px,96%);background:var(--card);padding:16px;border-radius:10px;border:1px solid var(--ring)">
      <h4>Bloquear Usu√°rio (tempor√°rio - client)</h4>
      <p class="muted">Digite o e-mail ou parte do identificador para bloquear (ex: jm ou jm@dominio.com)</p>
      <input id="blockInput" class="input" placeholder="ex: jm" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn warn" id="doBlockBtn">Bloquear</button>
        <button class="btn" id="closeBlockDialog">Cancelar</button>
      </div>
      <div style="margin-top:8px" class="muted">Obs: bloqueio client-side fica no seu navegador (localStorage). Para bloquear globalmente, bloqueie a conta no backend (Firebase/Auth) ‚Äî posso te enviar script pronto.</div>
    </div>
  </div>

  <!-- Modal Loja (iframe) -->
  <div id="modalShop" role="dialog" aria-modal="true" aria-hidden="true" class="hidden">
    <div class="inner" role="document">
      <div class="toolbar">
        <div class="left">
          <button id="closeShopBtn" class="btn" aria-label="Fechar loja">Fechar</button>
          <span class="note">Loja embutida ‚Äî usar o bot√£o para abrir em nova aba se preferir</span>
        </div>
        <div>
          <a id="openShopInNewTab" class="btn" href="../loja/index.html" target="_blank" rel="noopener">Abrir em nova aba</a>
        </div>
      </div>
      <!-- iframe aponta para a loja local (relative path) -->
      <iframe id="shopIframe" src="../loja/index.html" title="Loja Respect Style"></iframe>
    </div>
  </div>

  <footer style="text-align:center;padding:18px;color:#777;background:transparent;margin-top:30px;">
    ¬© 2025 Respect Style. Todos os direitos reservados.
  </footer>

  <!-- Swiper -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <script>
    /***********************
     * DATA SEED (demo)
     ***********************/
    const COMPETITIONS = [
      { id:'c1', date:'2025-11-10', title:'Copa Estadual de Jiu-Jitsu', location:'Gin√°sio Municipal', link:'#' },
      { id:'c2', date:'2025-12-07', title:'Open Respect Cup', location:'Centro Esportivo', link:'#' },
      { id:'c3', date:'2026-01-20', title:'Circuito Norte/Nordeste', location:'Gin√°sio Regional', link:'#' }
    ];

    const GRADUATES = [
      { id:'g1', name:'Carlos Silva', grade:'Faixa Azul', date:'2025-08-12' },
      { id:'g2', name:'Mariana Souza', grade:'Faixa Roxa', date:'2025-09-22' },
      { id:'g3', name:'Felipe Costa', grade:'Faixa Marrom', date:'2025-10-05' },
      { id:'g4', name:'Ana Pereira', grade:'Faixa Preta', date:'2025-10-10' }
    ];

    const STUDENTS = [
      { id:'s1', name:'Carlos Silva', dob:'1995-10-12', email:'carlos@example.com' },
      { id:'s2', name:'Mariana Souza', dob:'1992-11-05', email:'mariana@example.com' },
      { id:'s3', name:'Felipe Costa', dob:'2000-10-25', email:'felipe@example.com' },
      { id:'s4', name:'Ana Pereira', dob:'1990-10-03', email:'ana@example.com' },
      { id:'s5', name:'Joao JM', dob:'1988-03-15', email:'jm@exemplo.com' } // <= exemplo jm
    ];

    const FEDERATIONS = [
      { name:'CBJJ (Confedera√ß√£o Brasileira de Jiu-Jitsu)', url:'https://www.cbjj.com.br' },
      { name:'CBJJE (Confedera√ß√£o Brasileira de Jiu-Jitsu Esportivo)', url:'https://www.cbjje.com.br' },
      { name:'IBJJF', url:'https://ibjjf.com' }
    ];

    const SESSIONS = [
      { id:'t1', title:'Gi - Avan√ßado', time:'Seg 19:00 - 20:30' },
      { id:'t2', title:'NoGi - T√©cnicas', time:'Qua 19:00 - 20:30' },
      { id:'t3', title:'Infantil', time:'S√°b 10:00 - 11:00' }
    ];

    // local storage keys
    const LS_BLOCKED = 'respect_blocked_users_v1';
    const LS_USER = 'respect_user_v1';

    /***********************
     * Helpers: storage blocklist
     ***********************/
    function getBlockedList(){
      try { return JSON.parse(localStorage.getItem(LS_BLOCKED)) || [] } catch(e){ return [] }
    }
    function addBlocked(idOrEmail){
      const list = getBlockedList();
      if(!list.includes(idOrEmail)) list.push(idOrEmail);
      localStorage.setItem(LS_BLOCKED, JSON.stringify(list));
    }
    function isBlocked(emailOrId){
      if(!emailOrId) return false;
      const txt = String(emailOrId).toLowerCase();
      return getBlockedList().some(b => txt.includes(String(b).toLowerCase()));
    }

    /***********************
     * Basic auth (demo)
     ***********************/
    function getStoredUser(){ try { return JSON.parse(localStorage.getItem(LS_USER)); } catch(e){ return null } }
    function setStoredUser(u){ localStorage.setItem(LS_USER, JSON.stringify(u)); }
    function clearUser(){ localStorage.removeItem(LS_USER); }

    // UI init
    document.addEventListener('DOMContentLoaded', () => {
      // nav
      document.querySelectorAll('.nav-item').forEach(el => el.addEventListener('click', () => {
        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
        el.classList.add('active');
        showView(el.getAttribute('data-view'));
      }));

      // top actions
      document.getElementById('openShopBtn').addEventListener('click', openShopModal);
      document.getElementById('openSupport').addEventListener('click', ()=>window.open('https://wa.me/5599999999999','_blank'));

      // auth area
      renderAuthArea();

      // modal handlers
      document.getElementById('submitAuth').addEventListener('click', handleLogin);
      document.getElementById('closeModal').addEventListener('click', ()=>document.getElementById('modalBg').classList.add('hidden'));

      // admin block dialog
      document.getElementById('adminBlockBtn').addEventListener('click', ()=>document.getElementById('blockDialog').classList.remove('hidden'));
      document.getElementById('closeBlockDialog').addEventListener('click', ()=>document.getElementById('blockDialog').classList.add('hidden'));
      document.getElementById('doBlockBtn').addEventListener('click', doBlock);

      // shop modal
      document.getElementById('closeShopBtn').addEventListener('click', closeShopModal);
      // update "abrir em nova aba" link dynamically (in case path changes)
      document.getElementById('openShopInNewTab').href = '../loja/index.html';

      // render sections
      initCompetitionsSwiper();
      renderGraduates();
      renderBirthdays();
      renderFeds();
      renderQuickSchedule();

      // views default
      showView('dashboard');

      // keyboard: ESC fecham modais
      document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape') {
          closeShopModal();
          document.getElementById('modalBg').classList.add('hidden');
          document.getElementById('blockDialog').classList.add('hidden');
        }
      });
    });

    /***********************
     * Render auth area (topbar + sidebar)
     ***********************/
    function renderAuthArea(){
      const container = document.getElementById('authArea');
      container.innerHTML = '';
      const user = getStoredUser();
      if(user){
        const pill = document.createElement('div');
        pill.className = 'user-pill';
        pill.innerHTML = `<img src="${escape(user.avatar||'https://via.placeholder.com/48')}" alt="a" style="width:28px;height:28px;border-radius:6px"><div>${escape(user.name||'Aluno')}</div>`;
        container.appendChild(pill);

        // show logout on pill click
        pill.addEventListener('click', ()=>{ if(confirm('Deseja sair?')) { clearUser(); renderAuthArea(); location.reload(); } });
        // update sidebar info
        document.getElementById('sidebarName').innerText = user.name || 'Aluno';
        document.getElementById('sidebarEmail').innerText = user.email || '';
        document.getElementById('sidebarAvatar').src = user.avatar || 'https://via.placeholder.com/64';
      } else {
        const btn = document.createElement('button'); btn.className='btn'; btn.innerText='Entrar';
        btn.addEventListener('click', ()=> document.getElementById('modalBg').classList.remove('hidden'));
        container.appendChild(btn);
        document.getElementById('sidebarName').innerText = 'Convidado';
        document.getElementById('sidebarEmail').innerText = 'N√£o autenticado';
        document.getElementById('sidebarAvatar').src = 'https://via.placeholder.com/64x64?text=?';
      }
    }

    /***********************
     * Login handler (demo)
     ***********************/
    function handleLogin(){
      const email = document.getElementById('authEmail').value.trim();
      const pass = document.getElementById('authPass').value.trim();
      if(!email || !pass){ alert('Preencha e-mail e senha'); return; }

      // BLOCK CHECK
      if(isBlocked(email) || isBlocked(pass) || isBlocked(email.split('@')[0])){
        alert('Este usu√°rio foi bloqueado. Acesso negado.');
        document.getElementById('modalBg').classList.add('hidden');
        return;
      }

      // demo logic: autentica localmente (substituir por Firebase/Auth no futuro)
      const user = { name: email.split('@')[0], email, avatar: 'https://via.placeholder.com/160x160?text='+encodeURIComponent(email.split('@')[0]) };
      setStoredUser(user);
      alert('Login efetuado (demo).');
      document.getElementById('modalBg').classList.add('hidden');
      renderAuthArea();
    }

    /***********************
     * ADMIN: doBlock (client-side)
     ***********************/
    function doBlock(){
      const v = document.getElementById('blockInput').value.trim();
      if(!v){ alert('Digite um identificador (ex: jm ou jm@dominio.com)'); return; }
      addBlocked(v);
      // se o usu√°rio atual corresponder ao bloqueio, for√ßar logout
      const user = getStoredUser();
      if(user && (user.email.toLowerCase().includes(v.toLowerCase()) || user.name.toLowerCase().includes(v.toLowerCase()))){
        clearUser();
        alert('Usu√°rio atualmente logado corresponde ao bloqueio e foi desconectado.');
        renderAuthArea();
      } else {
        alert('Identificador bloqueado (client-side). Para bloqueio global, realize no backend.');
      }
      document.getElementById('blockDialog').classList.add('hidden');
    }

    /***********************
     * Competitions swiper
     ***********************/
    let compSwiper;
    function initCompetitionsSwiper(){
      const wrap = document.getElementById('competitionsWrapper');
      if(!wrap) return;
      wrap.innerHTML = '';
      COMPETITIONS.forEach(c => {
        const slide = document.createElement('div'); slide.className='swiper-slide';
        slide.innerHTML = `
          <div style="font-size:13px;color:var(--muted)">${escape(c.date)}</div>
          <div class="comp-title">${escape(c.title)}</div>
          <div class="small">${escape(c.location)}</div>
          <div style="margin-top:8px"><a class="btn" href="${c.link || '#'}" target="_blank">Detalhes</a></div>
        `;
        wrap.appendChild(slide);
      });

      // try init swiper only if Swiper library loaded
      try {
        compSwiper = new Swiper('.mySwiper', {
          slidesPerView: 1,
          spaceBetween: 12,
          loop: true,
          navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
          pagination: { el: '.swiper-pagination', clickable: true },
          breakpoints: { 640:{ slidesPerView: 2 }, 1024:{ slidesPerView: 3 } }
        });
      } catch(e){
        console.warn('Swiper init falhou (biblioteca ausente):', e);
      }
    }

    /***********************
     * Graduates
     ***********************/
    function renderGraduates(){
      const wrap = document.getElementById('graduatesList');
      wrap.innerHTML = '';
      GRADUATES.slice(0,20).forEach(g => {
        const div = document.createElement('div'); div.className='grad-item';
        div.innerHTML = `<div><strong>${escape(g.name)}</strong><div class="small">${escape(g.grade)} ‚Ä¢ ${escape(g.date)}</div></div><div class="small">${escape(g.id)}</div>`;
        wrap.appendChild(div);
      });

      // full list
      const full = document.getElementById('graduatesFull'); full.innerHTML = '';
      GRADUATES.forEach(g => {
        const el = document.createElement('div'); el.className='grad-item'; el.innerHTML = `<div><strong>${escape(g.name)}</strong><div class="small">${escape(g.grade)} ‚Ä¢ ${escape(g.date)}</div></div>`;
        full.appendChild(el);
      });

      // search
      document.getElementById('searchGraduate').addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase();
        const items = GRADUATES.filter(x => x.name.toLowerCase().includes(q) || x.grade.toLowerCase().includes(q));
        const w = document.getElementById('graduatesList'); w.innerHTML = '';
        items.slice(0,50).forEach(g => {
          const d = document.createElement('div'); d.className='grad-item'; d.innerHTML = `<div><strong>${escape(g.name)}</strong><div class="small">${escape(g.grade)} ‚Ä¢ ${escape(g.date)}</div></div>`;
          w.appendChild(d);
        });
      });
    }

    /***********************
     * Birthdays this month
     ***********************/
    function renderBirthdays(){
      const list = document.getElementById('birthdaysList');
      const full = document.getElementById('birthdaysFull');
      list.innerHTML = ''; full.innerHTML = '';
      const now = new Date();
      const month = now.getMonth() + 1; // 1..12
      const birthdays = STUDENTS.filter(s => {
        if(!s.dob) return false;
        const parts = s.dob.split('-'); // YYYY-MM-DD
        const m = parseInt(parts[1],10);
        return m === month;
      });

      if(birthdays.length === 0){
        list.innerHTML = '<div class="small muted">Nenhum aniversariante este m√™s.</div>';
      } else {
        birthdays.forEach(s => {
          const parts = s.dob.split('-'); const day = parts[2];
          const el = document.createElement('div'); el.className='grad-item'; el.innerHTML = `<div><strong>${escape(s.name)}</strong><div class="small">Anivers√°rio: ${day}/${(new Date(s.dob).getMonth()+1)}</div></div><div class="small">${escape(s.email)}</div>`;
          list.appendChild(el);
        });
      }

      // full list - group by month
      STUDENTS.forEach(s => {
        const el = document.createElement('div'); el.className='grad-item'; el.innerHTML = `<div><strong>${escape(s.name)}</strong><div class="small">Nascimento: ${escape(s.dob)}</div></div><div class="small">${escape(s.email)}</div>`;
        full.appendChild(el);
      });
    }

    /***********************
     * Federations links
     ***********************/
    function renderFeds(){
      const wrap = document.getElementById('federationsList');
      wrap.innerHTML = '';
      FEDERATIONS.forEach(f => {
        const div = document.createElement('div'); div.className='grad-item'; div.innerHTML = `<div style="font-weight:700">${escape(f.name)}</div><div class="small">${escape(f.url)}</div><div style="margin-top:6px"><a class="btn" href="${f.url}" target="_blank">Abrir</a></div>`;
        wrap.appendChild(div);
      });

      // full links page
      const full = document.getElementById('linksFull'); full.innerHTML = '';
      FEDERATIONS.forEach(f => {
        const el = document.createElement('div'); el.className='grad-item'; el.innerHTML = `<div style="font-weight:700">${escape(f.name)}</div><div class="small">${escape(f.url)}</div><div style="margin-top:6px"><a class="btn" href="${f.url}" target="_blank">Abrir</a></div>`;
        full.appendChild(el);
      });
    }

    /***********************
     * Quick schedule
     ***********************/
    function renderQuickSchedule(){
      const wrap = document.getElementById('quickSchedule');
      wrap.innerHTML = '';
      SESSIONS.forEach(s => {
        const el = document.createElement('div'); el.className='grad-item';
        el.innerHTML = `<div><strong>${escape(s.title)}</strong><div class="small">${escape(s.time)}</div></div><div><button class="btn" onclick="markPresence('${s.id}')">Presen√ßa</button></div>`;
        wrap.appendChild(el);
      });

      // full schedule
      const full = document.getElementById('fullSchedule'); full.innerHTML = '';
      SESSIONS.forEach(s => {
        const el = document.createElement('div'); el.className='grad-item';
        el.innerHTML = `<div><strong>${escape(s.title)}</strong><div class="small">${escape(s.time)}</div></div><div><button class="btn" onclick="markPresence('${s.id}')">Marcar</button></div>`;
        full.appendChild(el);
      });
    }

    function markPresence(id){
      const user = getStoredUser();
      if(!user && !confirm('Voc√™ n√£o est√° logado. Deseja marcar presen√ßa como convidado?')) return;
      const when = new Date();
      alert('Presen√ßa marcada: ' + id + ' em ' + when.toLocaleString());
    }

    /***********************
     * View controller
     ***********************/
    function showView(name){
      const views = { dashboard:'view-dashboard', schedule:'view-schedule', notices:'view-notices', events:'view-events', graduates:'view-graduates', birthdays:'view-birthdays', links:'view-links' };
      for(const k in views) document.getElementById(views[k]).classList.toggle('hidden', k !== name);
    }

    /***********************
     * Modal Loja (iframe) controls
     ***********************/
    function openShopModal(){
      const modal = document.getElementById('modalShop');
      modal.classList.remove('hidden');
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');
      // lazy load iframe src if needed (already set) and try to resize
      resizeShopIframe();
      // clicking outside inner should close
      setTimeout(()=> {
        modal.addEventListener('click', onShopBackdropClick);
      }, 50);
    }
    function closeShopModal(){
      const modal = document.getElementById('modalShop');
      if(!modal) return;
      modal.classList.add('hidden');
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden','true');
      modal.removeEventListener('click', onShopBackdropClick);
    }
    function onShopBackdropClick(e){
      const inner = document.querySelector('#modalShop .inner');
      if(!inner.contains(e.target)) closeShopModal();
    }
    function resizeShopIframe(){
      const iframe = document.getElementById('shopIframe');
      if(!iframe) return;
      // try to set height to viewport minus toolbar
      const inner = document.querySelector('#modalShop .inner');
      if(inner){
        const toolbar = document.querySelector('#modalShop .toolbar');
        const height = Math.min(window.innerHeight - 120, 820);
        inner.style.height = height + 'px';
      }
    }
    window.addEventListener('resize', resizeShopIframe);

    /***********************
     * Utilities
     ***********************/
    function escape(s=''){ return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]); }

    /***********************
     * Optional: populate initial blocklist with 'jm' to immediately block any jm identifiers
     * (uncomment next line if you want JM blocked on load)
     ***********************/
    // addBlocked('jm');

    /***********************
     * Expose for debugging in console
     ***********************/
    window._respect = { addBlocked, getBlockedList, isBlocked, setStoredUser, getStoredUser, clearUser, openShopModal, closeShopModal };
  </script>
</body>
</html>
